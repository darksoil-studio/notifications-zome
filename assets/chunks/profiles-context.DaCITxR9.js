import{_ as S}from"./tslib.es6.kHcLnhpD.js";import{e as te}from"./provide.CB-ltRHt.js";import{n as Z,a as D,c as re,t as ne}from"./property.CktKRGPk.js";import{u as K,e as F,c as ie,D as g,T as se,d as oe,g as ae,f as ce,E as le,U as _,i as q,S as m,h as y,j as he,l as ue,H as C,r as L,m as U,n as fe,A as X,o as de,C as E,p as z,k as pe,q as ye}from"./notifications-client.Dxc8Nd9s.js";import{S as me}from"./signal-watcher.CKR4BRqc.js";function b(n){return"".concat(n<0?"-":"","0x").concat(Math.abs(n).toString(16).padStart(2,"0"))}var ge=16,ve=16,we=function(){function n(e,t){e===void 0&&(e=ge),t===void 0&&(t=ve),this.maxKeyLength=e,this.maxLengthPerKey=t,this.hit=0,this.miss=0,this.caches=[];for(var r=0;r<this.maxKeyLength;r++)this.caches.push([])}return n.prototype.canBeCached=function(e){return e>0&&e<=this.maxKeyLength},n.prototype.find=function(e,t,r){var s=this.caches[r-1];e:for(var i=0,o=s;i<o.length;i++){for(var c=o[i],l=c.bytes,a=0;a<r;a++)if(l[a]!==e[t+a])continue e;return c.str}return null},n.prototype.store=function(e,t){var r=this.caches[e.length-1],s={bytes:e,str:t};r.length>=this.maxLengthPerKey?r[Math.random()*r.length|0]=s:r.push(s)},n.prototype.decode=function(e,t,r){var s=this.find(e,t,r);if(s!=null)return this.hit++,s;this.miss++;var i=K(e,t,r),o=Uint8Array.prototype.slice.call(e,t,t+r);return this.store(o,i),i},n}(),xe=function(n,e,t,r){function s(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function c(f){try{a(r.next(f))}catch(d){o(d)}}function l(f){try{a(r.throw(f))}catch(d){o(d)}}function a(f){f.done?i(f.value):s(f.value).then(c,l)}a((r=r.apply(n,e||[])).next())})},I=function(n,e){var t={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},r,s,i,o;return o={next:c(0),throw:c(1),return:c(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function c(a){return function(f){return l([a,f])}}function l(a){if(r)throw new TypeError("Generator is already executing.");for(;t;)try{if(r=1,s&&(i=a[0]&2?s.return:a[0]?s.throw||((i=s.return)&&i.call(s),0):s.next)&&!(i=i.call(s,a[1])).done)return i;switch(s=0,i&&(a=[a[0]&2,i.value]),a[0]){case 0:case 1:i=a;break;case 4:return t.label++,{value:a[1],done:!1};case 5:t.label++,s=a[1],a=[0];continue;case 7:a=t.ops.pop(),t.trys.pop();continue;default:if(i=t.trys,!(i=i.length>0&&i[i.length-1])&&(a[0]===6||a[0]===2)){t=0;continue}if(a[0]===3&&(!i||a[1]>i[0]&&a[1]<i[3])){t.label=a[1];break}if(a[0]===6&&t.label<i[1]){t.label=i[1],i=a;break}if(i&&t.label<i[2]){t.label=i[2],t.ops.push(a);break}i[2]&&t.ops.pop(),t.trys.pop();continue}a=e.call(n,t)}catch(f){a=[6,f],s=0}finally{r=i=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}},H=function(n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=n[Symbol.asyncIterator],t;return e?e.call(n):(n=typeof __values=="function"?__values(n):n[Symbol.iterator](),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(i){t[i]=n[i]&&function(o){return new Promise(function(c,l){o=n[i](o),s(c,l,o.done,o.value)})}}function s(i,o,c,l){Promise.resolve(l).then(function(a){i({value:a,done:c})},o)}},x=function(n){return this instanceof x?(this.v=n,this):new x(n)},_e=function(n,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=t.apply(n,e||[]),s,i=[];return s={},o("next"),o("throw"),o("return"),s[Symbol.asyncIterator]=function(){return this},s;function o(u){r[u]&&(s[u]=function(h){return new Promise(function(p,k){i.push([u,h,p,k])>1||c(u,h)})})}function c(u,h){try{l(r[u](h))}catch(p){d(i[0][3],p)}}function l(u){u.value instanceof x?Promise.resolve(u.value.v).then(a,f):d(i[0][2],u)}function a(u){c("next",u)}function f(u){c("throw",u)}function d(u,h){u(h),i.shift(),i.length&&c(i[0][0],i[0][1])}},Ee=function(n){var e=typeof n;return e==="string"||e==="number"},A=-1,N=new DataView(new ArrayBuffer(0)),Ae=new Uint8Array(N.buffer),M=function(){try{N.getInt8(0)}catch(n){return n.constructor}throw new Error("never reached")}(),O=new M("Insufficient data"),Se=new we,ke=function(){function n(e,t,r,s,i,o,c,l){e===void 0&&(e=le.defaultCodec),t===void 0&&(t=void 0),r===void 0&&(r=_),s===void 0&&(s=_),i===void 0&&(i=_),o===void 0&&(o=_),c===void 0&&(c=_),l===void 0&&(l=Se),this.extensionCodec=e,this.context=t,this.maxStrLength=r,this.maxBinLength=s,this.maxArrayLength=i,this.maxMapLength=o,this.maxExtLength=c,this.keyDecoder=l,this.totalPos=0,this.pos=0,this.view=N,this.bytes=Ae,this.headByte=A,this.stack=[]}return n.prototype.reinitializeState=function(){this.totalPos=0,this.headByte=A,this.stack.length=0},n.prototype.setBuffer=function(e){this.bytes=F(e),this.view=ie(this.bytes),this.pos=0},n.prototype.appendBuffer=function(e){if(this.headByte===A&&!this.hasRemaining(1))this.setBuffer(e);else{var t=this.bytes.subarray(this.pos),r=F(e),s=new Uint8Array(t.length+r.length);s.set(t),s.set(r,t.length),this.setBuffer(s)}},n.prototype.hasRemaining=function(e){return this.view.byteLength-this.pos>=e},n.prototype.createExtraByteError=function(e){var t=this,r=t.view,s=t.pos;return new RangeError("Extra ".concat(r.byteLength-s," of ").concat(r.byteLength," byte(s) found at buffer[").concat(e,"]"))},n.prototype.decode=function(e){this.reinitializeState(),this.setBuffer(e);var t=this.doDecodeSync();if(this.hasRemaining(1))throw this.createExtraByteError(this.pos);return t},n.prototype.decodeMulti=function(e){return I(this,function(t){switch(t.label){case 0:this.reinitializeState(),this.setBuffer(e),t.label=1;case 1:return this.hasRemaining(1)?[4,this.doDecodeSync()]:[3,3];case 2:return t.sent(),[3,1];case 3:return[2]}})},n.prototype.decodeAsync=function(e){var t,r,s,i;return xe(this,void 0,void 0,function(){var o,c,l,a,f,d,u,h;return I(this,function(p){switch(p.label){case 0:o=!1,p.label=1;case 1:p.trys.push([1,6,7,12]),t=H(e),p.label=2;case 2:return[4,t.next()];case 3:if(r=p.sent(),!!r.done)return[3,5];if(l=r.value,o)throw this.createExtraByteError(this.totalPos);this.appendBuffer(l);try{c=this.doDecodeSync(),o=!0}catch(k){if(!(k instanceof M))throw k}this.totalPos+=this.pos,p.label=4;case 4:return[3,2];case 5:return[3,12];case 6:return a=p.sent(),s={error:a},[3,12];case 7:return p.trys.push([7,,10,11]),r&&!r.done&&(i=t.return)?[4,i.call(t)]:[3,9];case 8:p.sent(),p.label=9;case 9:return[3,11];case 10:if(s)throw s.error;return[7];case 11:return[7];case 12:if(o){if(this.hasRemaining(1))throw this.createExtraByteError(this.totalPos);return[2,c]}throw f=this,d=f.headByte,u=f.pos,h=f.totalPos,new RangeError("Insufficient data in parsing ".concat(b(d)," at ").concat(h," (").concat(u," in the current buffer)"))}})})},n.prototype.decodeArrayStream=function(e){return this.decodeMultiAsync(e,!0)},n.prototype.decodeStream=function(e){return this.decodeMultiAsync(e,!1)},n.prototype.decodeMultiAsync=function(e,t){return _e(this,arguments,function(){var s,i,o,c,l,a,f,d,u;return I(this,function(h){switch(h.label){case 0:s=t,i=-1,h.label=1;case 1:h.trys.push([1,13,14,19]),o=H(e),h.label=2;case 2:return[4,x(o.next())];case 3:if(c=h.sent(),!!c.done)return[3,12];if(l=c.value,t&&i===0)throw this.createExtraByteError(this.totalPos);this.appendBuffer(l),s&&(i=this.readArraySize(),s=!1,this.complete()),h.label=4;case 4:h.trys.push([4,9,,10]),h.label=5;case 5:return[4,x(this.doDecodeSync())];case 6:return[4,h.sent()];case 7:return h.sent(),--i===0?[3,8]:[3,5];case 8:return[3,10];case 9:if(a=h.sent(),!(a instanceof M))throw a;return[3,10];case 10:this.totalPos+=this.pos,h.label=11;case 11:return[3,2];case 12:return[3,19];case 13:return f=h.sent(),d={error:f},[3,19];case 14:return h.trys.push([14,,17,18]),c&&!c.done&&(u=o.return)?[4,x(u.call(o))]:[3,16];case 15:h.sent(),h.label=16;case 16:return[3,18];case 17:if(d)throw d.error;return[7];case 18:return[7];case 19:return[2]}})})},n.prototype.doDecodeSync=function(){e:for(;;){var e=this.readHeadByte(),t=void 0;if(e>=224)t=e-256;else if(e<192)if(e<128)t=e;else if(e<144){var r=e-128;if(r!==0){this.pushMapState(r),this.complete();continue e}else t={}}else if(e<160){var r=e-144;if(r!==0){this.pushArrayState(r),this.complete();continue e}else t=[]}else{var s=e-160;t=this.decodeUtf8String(s,0)}else if(e===192)t=null;else if(e===194)t=!1;else if(e===195)t=!0;else if(e===202)t=this.readF32();else if(e===203)t=this.readF64();else if(e===204)t=this.readU8();else if(e===205)t=this.readU16();else if(e===206)t=this.readU32();else if(e===207)t=this.readU64();else if(e===208)t=this.readI8();else if(e===209)t=this.readI16();else if(e===210)t=this.readI32();else if(e===211)t=this.readI64();else if(e===217){var s=this.lookU8();t=this.decodeUtf8String(s,1)}else if(e===218){var s=this.lookU16();t=this.decodeUtf8String(s,2)}else if(e===219){var s=this.lookU32();t=this.decodeUtf8String(s,4)}else if(e===220){var r=this.readU16();if(r!==0){this.pushArrayState(r),this.complete();continue e}else t=[]}else if(e===221){var r=this.readU32();if(r!==0){this.pushArrayState(r),this.complete();continue e}else t=[]}else if(e===222){var r=this.readU16();if(r!==0){this.pushMapState(r),this.complete();continue e}else t={}}else if(e===223){var r=this.readU32();if(r!==0){this.pushMapState(r),this.complete();continue e}else t={}}else if(e===196){var r=this.lookU8();t=this.decodeBinary(r,1)}else if(e===197){var r=this.lookU16();t=this.decodeBinary(r,2)}else if(e===198){var r=this.lookU32();t=this.decodeBinary(r,4)}else if(e===212)t=this.decodeExtension(1,0);else if(e===213)t=this.decodeExtension(2,0);else if(e===214)t=this.decodeExtension(4,0);else if(e===215)t=this.decodeExtension(8,0);else if(e===216)t=this.decodeExtension(16,0);else if(e===199){var r=this.lookU8();t=this.decodeExtension(r,1)}else if(e===200){var r=this.lookU16();t=this.decodeExtension(r,2)}else if(e===201){var r=this.lookU32();t=this.decodeExtension(r,4)}else throw new g("Unrecognized type byte: ".concat(b(e)));this.complete();for(var i=this.stack;i.length>0;){var o=i[i.length-1];if(o.type===0)if(o.array[o.position]=t,o.position++,o.position===o.size)i.pop(),t=o.array;else continue e;else if(o.type===1){if(!Ee(t))throw new g("The type of key must be string or number but "+typeof t);if(t==="__proto__")throw new g("The key __proto__ is not allowed");o.key=t,o.type=2;continue e}else if(o.map[o.key]=t,o.readCount++,o.readCount===o.size)i.pop(),t=o.map;else{o.key=null,o.type=1;continue e}}return t}},n.prototype.readHeadByte=function(){return this.headByte===A&&(this.headByte=this.readU8()),this.headByte},n.prototype.complete=function(){this.headByte=A},n.prototype.readArraySize=function(){var e=this.readHeadByte();switch(e){case 220:return this.readU16();case 221:return this.readU32();default:{if(e<160)return e-144;throw new g("Unrecognized array type byte: ".concat(b(e)))}}},n.prototype.pushMapState=function(e){if(e>this.maxMapLength)throw new g("Max length exceeded: map length (".concat(e,") > maxMapLengthLength (").concat(this.maxMapLength,")"));this.stack.push({type:1,size:e,key:null,readCount:0,map:{}})},n.prototype.pushArrayState=function(e){if(e>this.maxArrayLength)throw new g("Max length exceeded: array length (".concat(e,") > maxArrayLength (").concat(this.maxArrayLength,")"));this.stack.push({type:0,size:e,array:new Array(e),position:0})},n.prototype.decodeUtf8String=function(e,t){var r;if(e>this.maxStrLength)throw new g("Max length exceeded: UTF-8 byte length (".concat(e,") > maxStrLength (").concat(this.maxStrLength,")"));if(this.bytes.byteLength<this.pos+t+e)throw O;var s=this.pos+t,i;return this.stateIsMapKey()&&(!((r=this.keyDecoder)===null||r===void 0)&&r.canBeCached(e))?i=this.keyDecoder.decode(this.bytes,s,e):e>se?i=oe(this.bytes,s,e):i=K(this.bytes,s,e),this.pos+=t+e,i},n.prototype.stateIsMapKey=function(){if(this.stack.length>0){var e=this.stack[this.stack.length-1];return e.type===1}return!1},n.prototype.decodeBinary=function(e,t){if(e>this.maxBinLength)throw new g("Max length exceeded: bin length (".concat(e,") > maxBinLength (").concat(this.maxBinLength,")"));if(!this.hasRemaining(e+t))throw O;var r=this.pos+t,s=this.bytes.subarray(r,r+e);return this.pos+=t+e,s},n.prototype.decodeExtension=function(e,t){if(e>this.maxExtLength)throw new g("Max length exceeded: ext length (".concat(e,") > maxExtLength (").concat(this.maxExtLength,")"));var r=this.view.getInt8(this.pos+t),s=this.decodeBinary(e,t+1);return this.extensionCodec.decode(s,r,this.context)},n.prototype.lookU8=function(){return this.view.getUint8(this.pos)},n.prototype.lookU16=function(){return this.view.getUint16(this.pos)},n.prototype.lookU32=function(){return this.view.getUint32(this.pos)},n.prototype.readU8=function(){var e=this.view.getUint8(this.pos);return this.pos++,e},n.prototype.readI8=function(){var e=this.view.getInt8(this.pos);return this.pos++,e},n.prototype.readU16=function(){var e=this.view.getUint16(this.pos);return this.pos+=2,e},n.prototype.readI16=function(){var e=this.view.getInt16(this.pos);return this.pos+=2,e},n.prototype.readU32=function(){var e=this.view.getUint32(this.pos);return this.pos+=4,e},n.prototype.readI32=function(){var e=this.view.getInt32(this.pos);return this.pos+=4,e},n.prototype.readU64=function(){var e=ae(this.view,this.pos);return this.pos+=8,e},n.prototype.readI64=function(){var e=ce(this.view,this.pos);return this.pos+=8,e},n.prototype.readF32=function(){var e=this.view.getFloat32(this.pos);return this.pos+=4,e},n.prototype.readF64=function(){var e=this.view.getFloat64(this.pos);return this.pos+=8,e},n}(),Te={};function $(n,e){e===void 0&&(e=Te);var t=new ke(e.extensionCodec,e.context,e.maxStrLength,e.maxBinLength,e.maxArrayLength,e.maxMapLength,e.maxExtLength);return t.decode(n)}function Pe(n){return Math.floor(n/1e3)}function Ue(n){var t,r;const e=(r=(t=n.entry)==null?void 0:t.Present)==null?void 0:r.entry;return $(e)}let Ce=class{constructor(e){this.record=e}get actionHash(){return this.record.signed_action.hashed.hash}get action(){const e=this.record.signed_action.hashed.content;return{...e,timestamp:Pe(e.timestamp)}}get entry(){return Ue(this.record)}get entryHash(){return this.record.signed_action.hashed.content.entry_hash}};q`
    .row {
      display: flex;
      flex-direction: row;
    }
    .column {
      display: flex;
      flex-direction: column;
    }
    .small-margin {
      margin-top: 6px;
    }
    .big-margin {
      margin-top: 23px;
    }

    .fill {
      flex: 1;
      height: 100%;
    }

    .title {
      font-size: 20px;
    }

    .center-content {
      align-items: center;
      justify-content: center;
    }

    .placeholder {
      color: var(--sl-color-gray-700);
    }

    .flex-scrollable-parent {
      position: relative;
      display: flex;
      flex: 1;
    }

    .flex-scrollable-container {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
    }

    .flex-scrollable-x {
      max-width: 100%;
      overflow-x: auto;
    }
    .flex-scrollable-y {
      max-height: 100%;
      overflow-y: auto;
    }
    :host {
      color: var(--sl-color-neutral-1000);
    }

    sl-card {
      display: flex;
    }
    sl-card::part(base) {
      flex: 1;
    }
    sl-card::part(body) {
      display: flex;
      flex: 1;
    }
    sl-drawer::part(body) {
      display: flex;
    }
  `;const be=Z("tnesh/appClientContext"),R=2e4;function B(n){return{base:n.hashed.content.base_address,author:n.hashed.content.author,link_type:n.hashed.content.link_type,tag:n.hashed.content.tag,target:n.hashed.content.target_address,timestamp:n.hashed.content.timestamp,zome_index:n.hashed.content.zome_index,create_link_hash:n.hashed.hash}}function Ie(n,e,t,r=R){let s=!1,i;const o=new m.State({status:"pending"},{[m.subtle.watched]:()=>{s=!0;let c;const l=f=>{if(!s)return;const d=J(f||[]).sort(Q);(!c||!j(d.map(u=>u.create_link_hash),c.map(u=>u.create_link_hash)))&&(c=d,o.set({status:"completed",value:c}))},a=()=>{s&&e().then(l).catch(f=>o.set({status:"error",error:f})).finally(()=>{s&&setTimeout(()=>a(),r)})};a(),i=n.onSignal(f=>{if(!f.type)return;const d=f;d.type==="LinkCreated"?t===d.link_type&&l([...c||[],B(d.action)]):d.type==="LinkDeleted"&&t===d.link_type&&l((c||[]).filter(u=>y(u.create_link_hash)!==y(d.create_link_action.hashed.hash)))})},[m.subtle.unwatched]:()=>{o.set({status:"pending"}),s=!1,i()}});return o}class W extends Error{constructor(){super("NOT_FOUND")}}function Me(n,e=1e3,t=4){let r=!1;const s=new m.State({status:"pending"},{[m.subtle.watched]:()=>{if(r)return;let i=0;const o=()=>{i+=1,n().then(c=>{c?(r=!0,s.set({status:"completed",value:c})):i<t?setTimeout(()=>o(),e):s.set({status:"error",error:new W})}).catch(c=>{i<t?setTimeout(()=>o(),e):s.set({status:"error",error:c})})};o()},[m.subtle.unwatched]:()=>{r||s.set({status:"pending"})}});return s}function De(n,e,t=R){let r=!1,s,i;const o=new m.State({status:"pending"},{[m.subtle.watched]:()=>{r=!0;const c=async()=>{if(r)try{const l=await e();l?(!i||y(i.actionHash)!==y(l.actionHash))&&(i=l,o.set({status:"completed",value:i})):o.set({status:"error",error:new W})}catch(l){o.set({status:"error",error:l})}finally{r&&setTimeout(()=>c(),t)}};c(),s=n.onSignal(l=>{if(!r||!l.type)return;const a=l;a.type==="EntryUpdated"&&i&&y(i.actionHash)===y(a.action.hashed.content.original_action_address)&&(i=new Ce({entry:{Present:{entry_type:"App",entry:he(a.app_entry)}},signed_action:a.action}),o.set({status:"completed",value:i}))})},[m.subtle.unwatched]:()=>{o.set({status:"pending"}),r=!1,i=void 0,s()}});return o}const Q=(n,e)=>n.timestamp-e.timestamp;function Ne(n){const e=n.map(r=>y(r));return[...new Set(e)].map(r=>U(r))}function J(n){const e=new fe;for(const t of n)e.set(t.create_link_hash,t);return Array.from(e.values())}function j(n,e){if(n.length!==e.length)return!1;for(let t=0;t<n.length;t+=1)if(y(n[t])!==y(e[t]))return!1;return!0}function G(n,e,t,r,s=R){let i=e;ue(i)===C.AGENT&&(i=L(i,C.ENTRY));let o=!1,c,l;const a=new m.State({status:"pending"},{[m.subtle.watched]:()=>{o=!0;const f=u=>{if(!o)return;const h=J(u||[]).sort(Q);(!l||!j(h.map(p=>p.create_link_hash),l.map(p=>p.create_link_hash)))&&(l=h,a.set({status:"completed",value:l}))},d=async()=>{o&&t().then(f).finally(()=>{o&&setTimeout(()=>d(),s)})};d().catch(u=>{a.set({status:"error",error:u})}),c=n.onSignal(u=>{if(!u.type)return;const h=u;h.type==="LinkCreated"?r===h.link_type&&(y(h.action.hashed.content.base_address)===y(i)||y(L(h.action.hashed.content.base_address,C.AGENT))===y(i))&&f([...l||[],B(h.action)]):h.type==="LinkDeleted"&&r===h.link_type&&y(h.create_link_action.hashed.content.base_address)===y(i)&&f((l||[]).filter(p=>y(p.create_link_hash)!==y(h.create_link_action.hashed.hash)))})},[m.subtle.unwatched]:()=>{a.set({status:"pending"}),o=!1,l=void 0,c()}});return a}function V(n,e){return new X(()=>{const t=n.get();return t.status!=="completed"?t:{status:"completed",value:e(t.value)}})}const Re=Z("hc_zome_profiles/store");var v;(function(n){n[n.AGENT=0]="AGENT",n[n.ENTRY=1]="ENTRY",n[n.DHTOP=2]="DHTOP",n[n.ACTION=3]="ACTION",n[n.DNA=4]="DNA"})(v||(v={}));const Fe="hCAk",Le="hCEk",ze="hCQk",He="hC0k",Oe="hCkk";function Ge(n){switch(n){case v.AGENT:return Fe;case v.ENTRY:return Le;case v.DHTOP:return ze;case v.ACTION:return Oe;case v.DNA:return He;default:return""}}function Ve(n,e){return new Uint8Array([...de.toUint8Array(Ge(e)),...n.slice(3)])}function Y(n,e){for(const[t,r]of Object.entries(n.cell_info))for(const s of r)if(E.Provisioned in s){if(s[E.Provisioned].cell_id.toString()===e.toString())return t}else if(E.Cloned in s&&s[E.Cloned].cell_id.toString()===e.toString())return s[E.Cloned].clone_id}async function Ye(n,e,t){if(n.cachedAppInfo){const i=Y(n.cachedAppInfo,t.cell_id);if(i)return e===i}const r=await n.appInfo(),s=Y(r,t.cell_id);return e===s}class Ze{constructor(e,t,r){this.client=e,this.roleName=t,this.zomeName=r}onSignal(e){return this.client.on("signal",async t=>{if(!(z.App in t))return;const r=t[z.App];await Ye(this.client,this.roleName,r)&&this.zomeName===r.zome_name&&e(r.payload)})}callZome(e,t){const r={role_name:this.roleName,zome_name:this.zomeName,fn_name:e,payload:t};return this.client.callZome(r)}}class ee{constructor(e){if(this._map=new Map,e)for(const[t,r]of e)this.set(t,r)}has(e){return this._map.has(y(e))}get(e){return this._map.get(y(e))}set(e,t){return this._map.set(y(e),t),this}delete(e){return this._map.delete(y(e))}keys(){return Array.from(this._map.keys()).map(e=>U(e))[Symbol.iterator]()}values(){return this._map.values()}entries(){return Array.from(this._map.entries()).map(([e,t])=>[U(e),t])[Symbol.iterator]()}clear(){return this._map.clear()}forEach(e,t){return this._map.forEach((r,s)=>{e(r,U(s),this)},t)}get size(){return this._map.size}[Symbol.iterator](){return this.entries()}get[Symbol.toStringTag](){return this._map[Symbol.toStringTag]}}class T{constructor(e){this.newValue=e,this.map=new ee}get(e){return this.map.has(e)||this.map.set(e,this.newValue(e)),this.map.get(e)}}function Ke(n,e){const t=new ee;for(const r of e)t.set(r,n.get(r));return t}function qe(n){return Math.floor(n/1e3)}function Xe(n){var t,r;const e=(r=(t=n.entry)==null?void 0:t.Present)==null?void 0:r.entry;return $(e)}class P{constructor(e){this.record=e}get actionHash(){return this.record.signed_action.hashed.hash}get action(){const e=this.record.signed_action.hashed.content;return{...e,timestamp:qe(e.timestamp)}}get entry(){return Xe(this.record)}get entryHash(){return this.record.signed_action.hashed.content.entry_hash}}class $e extends Ze{constructor(e,t,r="profiles"){super(e,t,r),this.client=e,this.roleName=t,this.zomeName=r}async getProfileForAgent(e){return this.callZome("get_profile_for_agent",e)}async getAgentsForProfile(e){return this.callZome("get_agents_for_profile",e)}async getLatestProfile(e){const t=await this.callZome("get_latest_profile",e);return t?new P(t):void 0}async getOriginalProfile(e){const t=await this.callZome("get_original_profile",e);return t?new P(t):void 0}async searchProfiles(e){return this.callZome("search_profiles",e)}async getAllProfiles(){return this.callZome("get_all_profiles",null)}async createProfile(e){const t=await this.callZome("create_profile",e);return new P(t)}async updateProfile(e,t){const r=await this.callZome("update_profile",{previous_profile_hash:e,updated_profile:t});return new P(r)}async linkMyAgentToProfile(e){await this.callZome("link_my_agent_to_profile",e)}}const Be={avatarMode:"avatar-optional",additionalFields:[],minNicknameLength:3};class We{constructor(e,t={}){this.client=e,this.allProfiles=V(Ie(this.client,()=>this.client.getAllProfiles(),"PathToProfile"),r=>{const s=r.map(i=>i.target);return Ke(this.profiles,s)}),this.agentToProfileLinks=new T(r=>G(this.client,r,()=>this.client.getProfileForAgent(r),"AgentToProfile")),this.profileForAgent=new T(r=>new X(()=>{const s=this.agentToProfileLinks.get(r).get();if(s.status!=="completed")return s;if(s.value.length===0)return{status:"completed",value:void 0};const o=s.value.sort((c,l)=>l.timestamp-c.timestamp)[0].target;return{status:"completed",value:this.profiles.get(o)}})),this.agentsForProfile=new T(r=>V(G(this.client,r,()=>this.client.getAgentsForProfile(r),"ProfileToAgent"),s=>Ne(s.map(i=>Ve(i.target,v.AGENT))))),this.profiles=new T(r=>({profileHash:r,latestVersion:De(this.client,()=>this.client.getLatestProfile(r)),original:Me(()=>this.client.getOriginalProfile(r))})),this.myProfile=this.profileForAgent.get(this.client.client.myPubKey),this.config={...Be,...t}}}let w=class extends me(ye){constructor(){super(...arguments),this.zome="profiles"}connectedCallback(){if(super.connectedCallback(),!this.store){if(!this.role)throw new Error('<profiles-context> must have a role="YOUR_DNA_ROLE" property, eg: <profiles-context role="role1">');if(!this.client)throw new Error(`<profiles-context> must either:
				a) be placed inside <app-client-context>
					or 
				b) receive an AppClient property (eg. <profiles-context .client=\${client}>) 
					or 
				c) receive a store property (eg. <profiles-context .store=\${store}>)`);this.store=new We(new $e(this.client,this.role,this.zome))}}render(){return pe`<slot></slot>`}};w.styles=q`
		:host {
			display: contents;
		}
	`;S([te({context:Re}),D({type:Object})],w.prototype,"store",void 0);S([re({context:be,subscribe:!0})],w.prototype,"client",void 0);S([D()],w.prototype,"role",void 0);S([D()],w.prototype,"zome",void 0);w=S([ne("profiles-context")],w);export{w as ProfilesContext};
